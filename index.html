<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calendrier de l‚Äô√©quipe</title>
  <style>
    :root{
      --bg:#f1f5f9;
      --card:#ffffff;
      --border:#e5e7eb;
      --text:#0f172a;
      --muted:#64748b;
      --primary-start:#3b2d57; /* match players widget */
      --primary-end:#0e4455;
      --win:#10b981;
      --loss:#ef4444;
      --draw:#f59e0b;
    }

    *{ box-sizing:border-box; margin:0; padding:0; }
    html, body{ width:100%; min-height:100%; background:transparent; color:var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; }

    .team-schedule{
      max-width:1200px;
      margin:18px auto;
      background:var(--card);
      border:1px solid var(--border);
      border-radius:16px;
      overflow:hidden;
      box-shadow:0 6px 24px rgba(0,0,0,.06);
    }

    .header{
      padding:16px;
      background:linear-gradient(90deg, var(--primary-start), var(--primary-end));
      color:#fff;
    }
    .header-title{ margin:0; font-size:22px; font-weight:800; }

    .content{ padding:16px; }

    /* Match card */
    .match{
      border:1px solid var(--border);
      border-radius:12px;
      margin-bottom:12px;
      overflow:hidden;
      background:#fff;
      box-shadow:0 2px 10px rgba(0,0,0,.03);
    }

    .match-head{
      display:flex; justify-content:space-between; align-items:center;
      padding:10px 12px;
      background:#f8fafc;
      border-bottom:1px solid var(--border);
      color:var(--muted);
      font-size:14px;
      gap:12px;
      flex-wrap:wrap;
    }
    .hv{ display:flex; gap:16px; align-items:center; }

    .match-body{ padding:16px; }
    .row{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; flex-wrap:wrap;
    }
    .team{
      display:flex; align-items:center; gap:10px; min-width:0; flex:1;
    }
    .team .name{
      font-weight:700; color:var(--text);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .score{
      display:flex; align-items:center; gap:10px; min-width:110px; justify-content:center;
    }
    .score .n{ font-size:28px; font-weight:800; }
    .score .sep{ color:#94a3b8; font-weight:700; }

    .status-wrap{ display:flex; justify-content:center; margin-top:10px; }
    .badge{
      font-size:12px; font-weight:800; padding:6px 12px; border-radius:14px;
      text-transform:uppercase; letter-spacing:.4px;
    }
    .badge-win   { background: rgba(16,185,129,.15); color: var(--win); }
    .badge-loss  { background: rgba(239,68,68,.15);  color: var(--loss); }
    .badge-draw  { background: rgba(245,158,11,.18); color: var(--draw); }
    .badge-forfeit{ background: rgba(239,68,68,.15); color: var(--loss); }
    .badge-scheduled{ display:none; } /* hide when scheduled */

    .empty{
      text-align:center; color:var(--muted); padding:36px 8px;
    }
    
    .logo{
        width:36px; height:36px; border-radius:50%;
        overflow:hidden; display:flex; align-items:center; justify-content:center;
        background:#f1f5f9;
    }
    .logo img{ width:100%; height:100%; object-fit:contain; display:block; }

    @media (max-width: 768px){
      .score .n{ font-size:24px; }
    }
  </style>
</head>
<body>
  <section class="team-schedule">
    <div class="header">
      <h1 class="header-title">Calendrier de l‚Äô√©quipe</h1>
    </div>
    <div class="content" id="content">
      <div class="empty">En attente des donn√©es‚Ä¶</div>
    </div>
  </section>

  <script>
    function fmtDateFR(s){
      const iso = /^\d{4}-\d{2}-\d{2}/.test((s||'').trim());
      if (iso){
        const d = new Date(s);
        if (!isNaN(d)){
          return d.toLocaleDateString('fr-CA',{ weekday:'short', month:'short', day:'numeric' });
        }
      }
      return s || 'Date √† venir';
    }

    function badgeClass(status){
      switch((status||'').toUpperCase()){
        case 'WIN': return 'badge-win';
        case 'LOSS': return 'badge-loss';
        case 'DRAW': return 'badge-draw';
        case 'FORFEIT': return 'badge-forfeit';
        default: return 'badge-scheduled';
      }
    }

    function badgeLabel(status, resultat){
      const s = (status||'').toUpperCase();
      if (s === 'WIN')     return resultat || 'Victoire';
      if (s === 'LOSS')    return resultat || 'D√©faite';
      if (s === 'DRAW')    return resultat || 'Match nul';
      if (s === 'FORFEIT') return 'Forfait';
      return '';
    }

    function scoreHtml(m){
      // show numbers only when we have numeric scores & not forfeit / scheduled
      const s = (m.status||'').toUpperCase();
      const numeric = Number.isFinite(m.ourScore) && Number.isFinite(m.oppScore);
      if (!numeric || s === 'FORFEIT' || s === 'SCHEDULED'){
        return `<div class="score"><span class="n" style="color:#94a3b8">‚Äì</span><span class="sep">-</span><span class="n" style="color:#94a3b8">‚Äì</span></div>`;
      }
      return `<div class="score"><span class="n">${m.ourScore}</span><span class="sep">-</span><span class="n">${m.oppScore}</span></div>`;
    }

    function render(team, matches){
      const content = document.getElementById('content');
      if (!matches || matches.length === 0){
        content.innerHTML = `<div class="empty">Aucun match</div>`;
        return;
      }

      if (team?.title){
        document.querySelector('.header-title').textContent = `Calendrier ‚Äî ${team.title}`;
      }

      content.innerHTML = matches.map(m => {
        const our = m.ourTeam || { title: team?.title || 'Notre √©quipe', logo: team?.logo || '' };
        const opp = m.opponent || { title: m.adversaire || 'Adversaire', logo: '' };

        return `
            <article class="match">
            <div class="match-head">
                <div class="hv"><span>üìÖ</span><span>${fmtDateFR(m.date)}</span></div>
                <div class="hv">
                ${m.terrain ? `<span>üìç ${m.terrain}</span>` : ''}
                ${m.heure ? `<span>üïê ${m.heure}</span>` : ''}
                </div>
            </div>
            <div class="match-body">
                <div class="row">
                <div class="team">
                    <div class="logo">
                    ${our.logo ? `<img src="${our.logo}" alt="${our.title}" width="36" height="36" loading="lazy">` : '‚öΩ'}
                    </div>
                    <div class="name">${our.title}</div>
                </div>

                ${scoreHtml(m)}

                <div class="team" style="justify-content:flex-end">
                    <div class="name" style="text-align:right">${opp.title}</div>
                    <div class="logo">
                    ${opp.logo ? `<img src="${opp.logo}" alt="${opp.title}" width="36" height="36" loading="lazy">` : '‚öΩ'}
                    </div>
                </div>
                </div>
                <div class="status-wrap">
                <span class="badge ${badgeClass(m.status)}">${badgeLabel(m.status, m.resultat)}</span>
                </div>
            </div>
            </article>
        `;
        }).join('');
    }

    // Listen for Wix
    window.addEventListener('message', (event) => {
      const msg = event.data || {};
      if (msg.type === 'TEAM_SCHEDULE_DATA' && msg.payload){
        render(msg.payload.team, msg.payload.matches);
      }
    });

    // Local test
    // setTimeout(() => {
    //   window.postMessage({
    //     type:'TEAM_SCHEDULE_DATA',
    //     payload:{
    //       team:{id:'X', title:'ESL'},
    //       matches:[
    //         {date:'2025-08-30', heure:'18h30', terrain:'Terrain 1', adversaire:'UST',  status:'WIN',  resultat:'Victoire 4-3', ourScore:4, oppScore:3, orderKey:1},
    //         {date:'2025-09-06', heure:'21h30', terrain:'',        adversaire:'Blue Lock', status:'LOSS', resultat:'D√©faite 4-5', ourScore:4, oppScore:5, orderKey:2},
    //         {date:'2025-09-13', heure:'18h30', terrain:'',        adversaire:'Kelb United',status:'WIN',  resultat:'Victoire 11-9', ourScore:11,oppScore:9, orderKey:3},
    //         {date:'2025-09-20', heure:'19h30', terrain:'',        adversaire:'Northside', status:'SCHEDULED', resultat:'', ourScore:null, oppScore:null, orderKey:4},
    //       ]
    //     }
    //   }, '*');
    // }, 300);
  </script>
</body>
</html>
