<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Player Card Widget</title>
  <style>
    /* Reset */
    * { margin:0; padding:0; box-sizing:border-box; }
    html, body {
      width:100%; height:100%; overflow:hidden; background:transparent;
      font-family: 'Poppins', system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }

    /* Container */
    #app {
      display:flex; justify-content:center; align-items:center;
      height:100%; padding:20px;
    }

    /* Player Card */
    .player-card {
      position:relative; width:250px; height:380px;
      background:linear-gradient(145deg, #216a7f, #17101e);
      border-radius:16px; overflow:hidden;
      box-shadow:0 8px 20px rgba(0,0,0,.4);
      display:flex; flex-direction:column; color:#fff;
    }

    /* Jersey number (top-left) */
    .jersey-number {
      position:absolute; top:10px; left:10px;
      font-size:18px; font-weight:bold; color:#fff;
      background:rgba(0,0,0,.4); padding:3px 8px; border-radius:5px; z-index:3;
    }

    /* Team name pill (top-right) */
    .team-name {
      position:absolute; top:10px; right:10px; z-index:3;
      display:flex; align-items:center; gap:6px;
      font-size:16px; font-weight:600;
      background:rgba(0,0,0,.4); padding:4px 8px; border-radius:6px;
      line-height:1;
    }

    /* Photo area */
    .player-photo { width:100%; overflow:hidden; position:relative; }
    .player-photo img {
      width:100%; height:180%; object-fit:cover; object-position:center top;
      display:block;
    }

    /* Player info */
    .player-info {
      display:flex; flex-direction:column; align-items:center;
      padding:6px 10px 4px 10px; text-align:center;
    }
    .player-name { font-size:20px; font-weight:bold; margin-bottom:6px; }

    /* Stats */
    .stats {
      display:flex; justify-content:space-around; width:100%;
      padding:8px 10px; background:rgba(0,0,0,.3);
      border-top:1px solid rgba(255,255,255,.1);
    }
    .stat { text-align:center; }
    .stat-label { font-size:14px; font-weight:500; color:#e2e8f0; }
    .stat-value { font-size:22px; font-weight:bold; margin-top:2px; }

    /* Fallback silhouette */
    .placeholder { width:100%; height:100%; opacity:.4; }

    /* -------- Team logo badge (reusable) -------- */
    .team-logo {
      width:26px; height:26px; border-radius:6px;
      overflow:hidden; display:flex; align-items:center; justify-content:center;
      background:rgba(255,255,255,.12);
      box-shadow:0 2px 8px rgba(0,0,0,.25);
    }
    .team-logo img { width:100%; height:100%; object-fit:contain; display:block; }

    /* Corner placements (absolute) */
    .logo-corner { position:absolute; z-index:3; }
    .logo-tr { top:10px; right:10px; }
    .logo-tl { top:10px; left:10px; transform:translateY(36px); } /* drops below jersey */
    .logo-br { bottom:10px; right:10px; }
    .logo-bl { bottom:10px; left:10px; }

    /* Above-name placement */
    .logo-above-name { margin-bottom:6px; }

    /* When logo is inside the team-name pill, tighten it up */
    .team-name .team-logo { width:20px; height:20px; border-radius:4px; background:rgba(255,255,255,.18); }
  </style>
</head>
<body>
  <div id="app"><p>En attente des donn√©es du joueur...</p></div>

  <script>
    const app = document.getElementById('app');

    /* Choose where the logo goes:
       'in-badge' | 'corner-tr' | 'corner-tl' | 'corner-br' | 'corner-bl' | 'above-name' */
    const LOGO_POSITION = 'in-badge';

    const FALLBACK_IMAGE = "https://cdn-icons-png.flaticon.com/512/64/64572.png";

    // Robustly handle Wix media IDs or plain URLs
    function normalizeImageUrl(value) {
      if (!value || typeof value !== 'string') return '';
      if (/^https?:\/\//i.test(value)) return value;
      const m = /^wix:image:\/\/v1\/([^\/#]+)/i.exec(value);
      if (m && m[1]) return `https://static.wixstatic.com/media/${m[1]}`;
      return '';
    }

    // Build the logo element for different placements
    function buildLogoHtml(logoUrl, alt, position) {
      if (!logoUrl) return '';

      if (position === 'in-badge') {
        return `<span class="team-logo"><img src="${logoUrl}" alt="${alt}" loading="lazy"></span>`;
      }
      if (position === 'above-name') {
        return `<div class="team-logo logo-above-name"><img src="${logoUrl}" alt="${alt}" loading="lazy"></div>`;
      }

      // corner placements
      const map = { 'corner-tr': 'logo-tr', 'corner-tl': 'logo-tl', 'corner-br': 'logo-br', 'corner-bl': 'logo-bl' };
      const cls = map[position] || 'logo-tr';
      return `<div class="team-logo logo-corner ${cls}"><img src="${logoUrl}" alt="${alt}" loading="lazy"></div>`;
    }

    // Listen for Wix
    window.addEventListener('message', function(event) {
      if (!event.data || event.data.type !== "PLAYER_DATA") return;
      renderPlayerCard(event.data.payload);
    });

    function renderPlayerCard(player) {
      const photoUrl = normalizeImageUrl(player.photo) || FALLBACK_IMAGE;
      const teamName  = player.equipe?.title ?? '';
      const teamLogo  = normalizeImageUrl(player.equipe?.logo);

      // Top-right team name pill (can include logo if LOGO_POSITION === 'in-badge')
      const teamNameHtml =
        `<div class="team-name">
           ${LOGO_POSITION === 'in-badge' && teamLogo ? buildLogoHtml(teamLogo, teamName, 'in-badge') : ''}
           ${teamName}
         </div>`;

      // Extra overlay logo if a corner position is chosen
      const cornerLogoHtml =
        (LOGO_POSITION.startsWith('corner') && teamLogo)
          ? buildLogoHtml(teamLogo, teamName, LOGO_POSITION)
          : '';

      // Logo above name (centered in info block)
      const logoAboveNameHtml =
        (LOGO_POSITION === 'above-name' && teamLogo)
          ? buildLogoHtml(teamLogo, teamName, 'above-name')
          : '';

      app.innerHTML = `
        <div class="player-card">
          <div class="jersey-number">${player.numero ?? ''}</div>
          ${teamNameHtml}
          ${cornerLogoHtml}

          <div class="player-photo">
            <img src="${photoUrl}" alt="Photo joueur" onerror="this.src='${FALLBACK_IMAGE}'">
          </div>

          <div class="player-info">
            ${logoAboveNameHtml}
            <div class="player-name">${player.nom ?? 'Joueur'}</div>

            <div class="stats">
              <div class="stat">
                <div class="stat-label">Buts</div>
                <div class="stat-value">${player.but ?? 0}</div>
              </div>
              <div class="stat">
                <div class="stat-label">Passes</div>
                <div class="stat-value">${player.passes ?? 0}</div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // For local testing, uncomment:
    // setTimeout(() => {
    //   window.postMessage({
    //     type:'PLAYER_DATA',
    //     payload:{
    //       nom:'Ahmed', numero:7, but:10, passes:2,
    //       photo:'', // put a real image if you want
    //       equipe:{ title:'CHAKS', logo:'wix:image://v1/11062b_13c29cfc3f924e2ca1a0d2abcd~mv2.png' }
    //     }
    //   }, '*');
    // }, 300);
  </script>
</body>
</html>
